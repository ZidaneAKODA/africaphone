<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <!-- Bootstrap Icons CDN -->
  <link 
    rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
  >

  <!-- 1) Firebase (compat) SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.2/firebase-auth-compat.js"></script>



<!-- 2) Initialisation Firebase & Auth -->
<script>
  // Ta config Firebase (m√™me que dans index.html)
  const firebaseConfig = {
    apiKey: "AIzaSyCvNZ5lhKdP_6W-eRle-7zCmFqejSfRuto",
    authDomain: "shoptel-35c7e.firebaseapp.com",
    projectId: "shoptel-35c7e",
    storageBucket: "shoptel-35c7e.firebasestorage.app",
    messagingSenderId: "541177101809",
    appId: "1:541177101809:web:5ae3ea186f198558371850",
    measurementId: "G-VH4MCV6Y6E"
  };

  // Initialise l‚Äôapp et Auth
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  console.log("üî• Firebase Auth initialis√© :", auth);

  function withSpinner(buttonId, actionFn) {
  const btn      = document.getElementById(buttonId);
  const textSpan = btn.querySelector('.btn-text');
  const spinner  = btn.querySelector('.loader');

  // d√©marre le spinner
  btn.disabled = true;
  textSpan.style.visibility = 'hidden';
  spinner.style.display = 'block';

  return actionFn()
    .catch(err => {
      // en cas d'erreur : stop spinner et restaure
      btn.disabled = false;
      spinner.style.display = 'none';
      textSpan.style.visibility = 'visible';
      throw err;
    });
}

</script>

  <style>

    

    :root {
      --primary: #1e90ff;
      --bg: #f5f5f5;
      --surface: #fff;
      --text: #333;
      --muted: #888;
      --radius: 8px;
      --transition: 0.3s ease;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    html, body {
      width:100%; height:100%;
      overflow:hidden;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      -webkit-tap-highlight-color: transparent;
    }

    /* container 2 √©crans */
    #app {
      display: flex;
      width:200%;
      height:100%;
      transition: transform var(--transition);
      overscroll-behavior: none;
    }
    .screen {
      width:100%;
      padding: 0 24px;
      padding: 48px 24px 0;
      background: var(--surface);
      overflow-y: auto;
      overscroll-behavior: none;
      -ms-overflow-style: none; scrollbar-width: none;
      display: flex; flex-direction: column; align-items: stretch;
    }
    .screen::-webkit-scrollbar { display: none; }
    /* Logo */
    .logo {
      margin: 48px auto 32px;
      text-align: center;
    }
    .logo img { width:48px; height:48px; }
    .logo h1 {
      margin-top:8px;
      font-size:24px;
      font-weight:400;
      color: var(--text);
    }
    /* Form */
    .form-group {
      position: relative;
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      color: var(--primary);
      margin-bottom: 6px;
    }
    .form-group input {
      width:100%;
      padding:12px 40px 12px 12px;
      font-size:16px;
      border:1px solid #ccc;
      border-radius: var(--radius);
      transition: border-color var(--transition), box-shadow var(--transition);
    }
    .form-group input:focus {
      outline:none;
      border-color: var(--primary);
      box-shadow: 0 1px 0 var(--primary);
    }
    /* Icons inside inputs */
    .form-group .icon {
      position:absolute;
      top:50%; right:12px;
      transform: translateY(-50%);
      font-size:18px;
      color: var(--muted);
      cursor: pointer;
      transition: color var(--transition);
    }
    .form-group .icon:hover {
      color: var(--primary);
    }
    /* Buttons */
    .btn {
  display:block;
  width:100%;
  padding:14px;
  margin-top:12px;
  font-size:16px;
  font-weight:500;
  text-align:center;
  background: var(--primary);
  color:#fff;
  border:none;
  border-radius:30px;
  cursor:pointer;
  transition: transform 0.1s ease, background var(--transition);
  user-select:none;
  position: relative;
  overflow: hidden;
}
.btn:active {
  transform: scale(0.97);
}

/* SPINNER INLINE */
.btn .loader {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255,255,255,0.6);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: none;
}
@keyframes spin {
  to { transform: translate(-50%, -50%) rotate(360deg); }
}

    /* Links */
    .link {
      text-align:center;
      margin-top:8px;
    }
    .link a {
      color: var(--primary);
      font-size:14px;
      text-decoration:none;
      transition: opacity var(--transition);
    }
    .link a:active {
      opacity:0.6;
    }
    /* OR separator */
    .or {
      display:flex;
      align-items:center;
      text-align:center;
      font-size:13px;
      color:#aaa;
      margin:24px 0;
    }
    .or::before, .or::after {
      content:'';
      flex:1;
      height:1px;
      background:#ddd;
    }
    .or::before { margin-right:8px; }
    .or::after { margin-left:8px; }

    /* H√©rit√© de .form-group .icon */
.clear-icon {
  display: none;      /* cach√© tant que le champ est vide */
}

/* messages d‚Äôerreur masqu√©s par d√©faut */
.input-error {
  display: none;
  color: #e74c3c;
  font-size: 13px;
  margin-top: 4px;
}

/* quand on veut l‚Äôafficher, on ajoute la classe .show */
.input-error.show {
  display: flex;
  align-items: center;
}

/* ic√¥ne d‚Äôerreur en 18px comme les autres */
.input-error i {
  margin-right: 6px;
  font-size: 18px;
  /* si jamais .icon met du absolute, on l‚Äôannule */
  position: static;
  cursor: default;
  color: inherit;
}



  </style>
</head>
<body>

  <div id="app">
    <!-- LOGIN -->
    <div class="screen" id="login-screen">
      
      <!-- === USERNAME === -->
<div class="form-group">
  <label for="login-user">Username</label>
  <input type="text" id="login-user" placeholder="Enter your email or username">
  <!-- Zone d‚Äôerreur sp√©cifique √† login-user -->
  <div class="input-error" id="error-login-user">
  <i class="bi bi-exclamation-circle-fill error-icon" aria-hidden="true"></i>
  <span class="error-text"></span>
</div>

</div>

<!-- === PASSWORD === -->
<div class="form-group">
  <label for="login-pw">Password</label>
  <input type="password" id="login-pw" placeholder="Password">
  <i class="bi bi-eye icon" id="toggle-login"></i>
  <!-- Zone d‚Äôerreur sp√©cifique √† login-pw -->
  <div class="input-error" id="error-login-pw" aria-live="assertive">
    <i class="bi bi-exclamation-circle-fill" aria-hidden="true"></i>
    <span class="error-text"></span>
  </div>
</div>


      <div class="link"><a href="#">Reset Password</a></div>
      <button class="btn" id="btn-login">
  <span class="btn-text">Sign in with email</span>
  <div class="loader"></div>
</button>


      <div class="or">OR</div>
      <div class="link"><a href="#" id="to-signup">Create an account</a></div>
    </div>

    <!-- SIGN UP -->
    <div class="screen" id="signup-screen">

      <div class="form-group">
        <label for="signup-first">First Name</label>
        <input type="text" id="signup-first" placeholder="First Name">
      </div>

      <div class="form-group">
        <label for="signup-last">Last Name</label>
        <input type="text" id="signup-last" placeholder="Last Name">
      </div>

      <div class="form-group">
        <label for="signup-email">Email</label>
        <input type="email" id="signup-email" placeholder="Email">
      </div>

      <div class="form-group">
        <label for="signup-pw">Password</label>
        <input type="password" id="signup-pw" placeholder="Password">
        <i class="bi bi-eye icon" id="toggle-signup"></i>
      </div>


      <div class="link" style="font-size:13px;line-height:1.4;">
        By signing up, you agree to our <a href="#">Privacy and Term</a>
      </div>
      <button class="btn" id="btn-signup">
  <span class="btn-text">Create an account</span>
  <div class="loader"></div>
</button>


      <div class="or">OR</div>
      <div class="link"><a href="#" id="to-login">Login to your account</a></div>
    </div>
  </div>

  <script>
    const app = document.getElementById('app');
    const toSignup = () => app.style.transform = 'translateX(-50%)';
    const toLogin  = () => app.style.transform = 'translateX(0)';

    document.getElementById('to-signup').onclick = e => { e.preventDefault(); toSignup(); };
    document.getElementById('to-login').onclick  = e => { e.preventDefault(); toLogin(); };

    // Toggle password visibility
    function bindToggle(btnId, inputId, iconVisible = 'bi-eye', iconHidden = 'bi-eye-slash') {
      const btn = document.getElementById(btnId);
      const inp = document.getElementById(inputId);
      btn.addEventListener('click', () => {
        if (inp.type === 'password') {
          inp.type = 'text';
          btn.classList.replace(iconVisible, iconHidden);
        } else {
          inp.type = 'password';
          btn.classList.replace(iconHidden, iconVisible);
        }
      });
    }
    bindToggle('toggle-login','login-pw');
    bindToggle('toggle-signup','signup-pw');


    // Touch-swipe navigation
    let startX = 0;
    app.addEventListener('touchstart', e => { startX = e.touches[0].clientX; });
    app.addEventListener('touchend',   e => {
      const diff = startX - e.changedTouches[0].clientX;
      if (diff > 50) toSignup();
      if (diff < -50) toLogin();
    });
  </script>

  <script>
// Apr√®s bindToggle et swipe‚Ä¶

// R√©cup√©ration des inputs
const loginUser = document.getElementById('login-user');
const loginPw   = document.getElementById('login-pw');
const signupFirst = document.getElementById('signup-first');
const signupLast  = document.getElementById('signup-last');
const signupEmail = document.getElementById('signup-email');
const signupPw    = document.getElementById('signup-pw');

// ‚Äî utilitaires pour chaque champ : ‚Äî
function showFieldError(fieldId, message) {
  const errDiv = document.getElementById(`error-${fieldId}`);
  errDiv.querySelector('.error-text').textContent = message;
  errDiv.classList.add('show');
}

function clearFieldError(fieldId) {
  const errDiv = document.getElementById(`error-${fieldId}`);
  errDiv.classList.remove('show');
  errDiv.querySelector('.error-text').textContent = '';
}

// Effacer l‚Äôerreur d√®s qu‚Äôon retape quelque chose
[loginUser, loginPw].forEach(input => {
  input.addEventListener('input', () => clearFieldError(input.id));
});

// Sign in
document.getElementById('btn-login').addEventListener('click', () => {
  // 1) on efface d‚Äô√©ventuelles vieilles erreurs
  clearFieldError('login-user');
  clearFieldError('login-pw');

  // 2) on r√©cup√®re et valide
  const email = loginUser.value.trim();
  const pw    = loginPw.value;

  if (!email) {
    showFieldError('login-user', 'Veuillez entrer votre email.');
    loginUser.focus(); return;
  }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    showFieldError('login-user', 'Adresse email non valide.');
    loginUser.focus(); return;
  }
  if (pw.length < 6) {
    showFieldError('login-pw', 'Le mot de passe doit faire ‚â• 6 caract√®res.');
    loginPw.focus(); return;
  }

  // 3) on appelle Firebase
  withSpinner('btn-login', () =>
    auth.signInWithEmailAndPassword(email, pw)
  )
  .then(() => window.location.href = 'index.html')
  .catch(err => {
    // 4) on traite les codes d‚Äôerreur Firebase
    switch (err.code) {
      case 'auth/invalid-email':
      case 'auth/user-not-found':
        showFieldError('login-user', 'Email inconnu ou invalide.');
        loginUser.focus();
        break;
      case 'auth/wrong-password':
        showFieldError('login-pw', 'Mot de passe incorrect.');
        loginPw.focus();
        break;
      case 'auth/user-disabled':
        showFieldError('login-user', 'Ce compte a √©t√© d√©sactiv√©.');
        break;
      default:
        showFieldError('login-user', err.message);
    }
  });
});

// R√©cup√®re la fonction callable


  // SIGNUP
document.getElementById('btn-signup').addEventListener('click', () => {
  withSpinner('btn-signup', async () => {
    const firstname = signupFirst.value.trim();
    const lastname  = signupLast.value.trim();
    if (!firstname || !lastname) {
      alert("Veuillez indiquer votre nom et pr√©nom.");
      return Promise.reject();
    }
    const userCred = await auth.createUserWithEmailAndPassword(
      signupEmail.value, signupPw.value
    );
    await userCred.user.updateProfile({
      displayName: firstname + ' ' + lastname
    });
    await auth.currentUser.getIdToken(true);
    window.location.href = 'index.html';
  })
  .catch(err => {
    if (err && err.message) alert(err.message);
  });
});
  
</script>

</body>
</html>
